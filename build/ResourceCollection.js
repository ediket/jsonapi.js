
'use strict';

var _ = require('lodash');
var Backbone = require('backbone');
var Collection = Backbone.Collection;
var Resource = require('./Resource');
var SerializeMixin = require('./SerializeMixin');

module.exports = Collection.extend(_.extend({}, SerializeMixin, {

  sync: function sync() {
    return false;
  },

  initialize: function initialize(models, options) {

    if (!options || !options.type) {
      throw new Error('type is required');
    }

    this.type = options.type;

    this.on('add', function (resource) {

      if (resource.type !== this.type) {
        throw new Error('type [' + this.type + '] is required');
      }
    });
  },

  create: function create() {

    if (arguments[0]) {
      arguments[0].type = arguments[0].type || this.type;
    }

    return Collection.prototype.create.apply(this, arguments);
  },

  model: Resource,

  toJSON: function toJSON() {

    return Collection.prototype.toJSON.apply(this, arguments);
  },

  toLinkage: function toLinkage() {

    return _.map(this.models, function (resource) {
      return resource.toLinkage();
    });
  },

  merge: function merge(resources) {

    if (!resources instanceof this.constructor) {
      throw new Error('merged resources should be a ResourceCollection');
    }

    this.set(resources.models, { remove: false });

    return this;
  }

}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9SZXNvdXJjZUNvbGxlY3Rpb24uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUNBLFlBQVksQ0FBQzs7QUFHYixJQUFJLENBQUMsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDMUIsSUFBSSxRQUFRLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQ25DLElBQUksVUFBVSxHQUFHLFFBQVEsQ0FBQyxVQUFVLENBQUM7QUFDckMsSUFBSSxRQUFRLEdBQUcsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBQ3JDLElBQUksY0FBYyxHQUFHLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDOztBQUdqRCxNQUFNLENBQUMsT0FBTyxHQUFHLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsY0FBYyxFQUFFOztBQUU5RCxNQUFJLEVBQUUsZ0JBQVk7QUFBRSxXQUFPLEtBQUssQ0FBQztHQUFFOztBQUVuQyxZQUFVLEVBQUUsb0JBQVUsTUFBTSxFQUFFLE9BQU8sRUFBRTs7QUFFckMsUUFBSSxDQUFDLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUU7QUFDN0IsWUFBTSxJQUFJLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0tBQ3JDOztBQUVELFFBQUksQ0FBQyxJQUFJLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQzs7QUFFekIsUUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsVUFBVSxRQUFRLEVBQUU7O0FBRWpDLFVBQUksUUFBUSxDQUFDLElBQUksS0FBSyxJQUFJLENBQUMsSUFBSSxFQUFFO0FBQy9CLGNBQU0sSUFBSSxLQUFLLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxJQUFJLEdBQUcsZUFBZSxDQUFDLENBQUM7T0FDekQ7S0FFRixDQUFDLENBQUM7R0FFSjs7QUFFRCxRQUFNLEVBQUUsa0JBQVk7O0FBRWxCLFFBQUksU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFO0FBQ2hCLGVBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDO0tBQ3BEOztBQUVELFdBQU8sVUFBVSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQztHQUUzRDs7QUFFRCxPQUFLLEVBQUUsUUFBUTs7QUFFZixRQUFNLEVBQUUsa0JBQVk7O0FBRWxCLFdBQU8sVUFBVSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQztHQUUzRDs7QUFFRCxXQUFTLEVBQUUscUJBQVk7O0FBRXJCLFdBQU8sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLFVBQVUsUUFBUSxFQUFFO0FBQzVDLGFBQU8sUUFBUSxDQUFDLFNBQVMsRUFBRSxDQUFDO0tBQzdCLENBQUMsQ0FBQztHQUVKOztBQUVELE9BQUssRUFBRSxlQUFVLFNBQVMsRUFBRTs7QUFFMUIsUUFBSSxDQUFDLFNBQVMsWUFBWSxJQUFJLENBQUMsV0FBVyxFQUFFO0FBQzFDLFlBQU0sSUFBSSxLQUFLLENBQUMsaURBQWlELENBQUMsQ0FBQztLQUNwRTs7QUFFRCxRQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQzs7QUFFOUMsV0FBTyxJQUFJLENBQUM7R0FFYjs7Q0FFRixDQUFDLENBQUMsQ0FBQyIsImZpbGUiOiJzcmMvUmVzb3VyY2VDb2xsZWN0aW9uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXG4ndXNlIHN0cmljdCc7XG5cblxudmFyIF8gPSByZXF1aXJlKCdsb2Rhc2gnKTtcbnZhciBCYWNrYm9uZSA9IHJlcXVpcmUoJ2JhY2tib25lJyk7XG52YXIgQ29sbGVjdGlvbiA9IEJhY2tib25lLkNvbGxlY3Rpb247XG52YXIgUmVzb3VyY2UgPSByZXF1aXJlKCcuL1Jlc291cmNlJyk7XG52YXIgU2VyaWFsaXplTWl4aW4gPSByZXF1aXJlKCcuL1NlcmlhbGl6ZU1peGluJyk7XG5cblxubW9kdWxlLmV4cG9ydHMgPSBDb2xsZWN0aW9uLmV4dGVuZChfLmV4dGVuZCh7fSwgU2VyaWFsaXplTWl4aW4sIHtcblxuICBzeW5jOiBmdW5jdGlvbiAoKSB7IHJldHVybiBmYWxzZTsgfSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbiAobW9kZWxzLCBvcHRpb25zKSB7XG5cbiAgICBpZiAoIW9wdGlvbnMgfHwgIW9wdGlvbnMudHlwZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCd0eXBlIGlzIHJlcXVpcmVkJyk7XG4gICAgfVxuXG4gICAgdGhpcy50eXBlID0gb3B0aW9ucy50eXBlO1xuXG4gICAgdGhpcy5vbignYWRkJywgZnVuY3Rpb24gKHJlc291cmNlKSB7XG5cbiAgICAgIGlmIChyZXNvdXJjZS50eXBlICE9PSB0aGlzLnR5cGUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCd0eXBlIFsnICsgdGhpcy50eXBlICsgJ10gaXMgcmVxdWlyZWQnKTtcbiAgICAgIH1cblxuICAgIH0pO1xuXG4gIH0sXG5cbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG5cbiAgICBpZiAoYXJndW1lbnRzWzBdKSB7XG4gICAgICBhcmd1bWVudHNbMF0udHlwZSA9IGFyZ3VtZW50c1swXS50eXBlIHx8IHRoaXMudHlwZTtcbiAgICB9XG5cbiAgICByZXR1cm4gQ29sbGVjdGlvbi5wcm90b3R5cGUuY3JlYXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG5cbiAgfSxcblxuICBtb2RlbDogUmVzb3VyY2UsXG5cbiAgdG9KU09OOiBmdW5jdGlvbiAoKSB7XG5cbiAgICByZXR1cm4gQ29sbGVjdGlvbi5wcm90b3R5cGUudG9KU09OLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG5cbiAgfSxcblxuICB0b0xpbmthZ2U6IGZ1bmN0aW9uICgpIHtcblxuICAgIHJldHVybiBfLm1hcCh0aGlzLm1vZGVscywgZnVuY3Rpb24gKHJlc291cmNlKSB7XG4gICAgICByZXR1cm4gcmVzb3VyY2UudG9MaW5rYWdlKCk7XG4gICAgfSk7XG5cbiAgfSxcblxuICBtZXJnZTogZnVuY3Rpb24gKHJlc291cmNlcykge1xuXG4gICAgaWYgKCFyZXNvdXJjZXMgaW5zdGFuY2VvZiB0aGlzLmNvbnN0cnVjdG9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ21lcmdlZCByZXNvdXJjZXMgc2hvdWxkIGJlIGEgUmVzb3VyY2VDb2xsZWN0aW9uJyk7XG4gICAgfVxuXG4gICAgdGhpcy5zZXQocmVzb3VyY2VzLm1vZGVscywgeyByZW1vdmU6IGZhbHNlIH0pO1xuXG4gICAgcmV0dXJuIHRoaXM7XG5cbiAgfVxuXG59KSk7XG4iXX0=