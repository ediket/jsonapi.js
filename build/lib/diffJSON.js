

'use strict';

var _ = require('lodash');

module.exports = function diffJSON(oldObj, newObj) {

  if (!(oldObj && newObj)) {
    throw new Error('two object is required:', oldObj, newObj);
  }

  var oldKeys = _.keys(oldObj);
  var newKeys = _.keys(newObj);

  var removedKeys = _.difference(oldKeys, newKeys);
  var addedKeys = _.difference(newKeys, oldKeys);
  var changedKeys = _.chain(_.intersection(oldKeys, newKeys)).filter(function (key) {
    return !_.isEqual(oldObj[key], newObj[key]);
  }).value();

  var result = {};

  _.each(removedKeys, function (key) {
    result[key] = {
      removed: oldObj[key]
    };
  });

  _.each(addedKeys, function (key) {
    result[key] = {
      added: newObj[key]
    };
  });

  _.each(changedKeys, function (key) {
    result[key] = {
      removed: oldObj[key],
      added: newObj[key]
    };
  });

  return result;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvZGlmZkpTT04uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFFQSxZQUFZLENBQUM7O0FBRWIsSUFBSSxDQUFDLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDOztBQUcxQixNQUFNLENBQUMsT0FBTyxHQUFHLFNBQVMsUUFBUSxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUU7O0FBRWpELE1BQUksRUFBRSxNQUFNLElBQUksTUFBTSxDQUFBLEFBQUMsRUFBRTtBQUN2QixVQUFNLElBQUksS0FBSyxDQUFDLHlCQUF5QixFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQztHQUM1RDs7QUFFRCxNQUFJLE9BQU8sR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQzdCLE1BQUksT0FBTyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7O0FBRTdCLE1BQUksV0FBVyxHQUFHLENBQUMsQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQ2pELE1BQUksU0FBUyxHQUFHLENBQUMsQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQy9DLE1BQUksV0FBVyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FDeEQsTUFBTSxDQUFDLFVBQVUsR0FBRyxFQUFFO0FBQ3JCLFdBQU8sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztHQUM3QyxDQUFDLENBQ0QsS0FBSyxFQUFFLENBQUM7O0FBRVgsTUFBSSxNQUFNLEdBQUcsRUFBRSxDQUFDOztBQUVoQixHQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxVQUFVLEdBQUcsRUFBRTtBQUNqQyxVQUFNLENBQUMsR0FBRyxDQUFDLEdBQUc7QUFDWixhQUFPLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQztLQUNyQixDQUFDO0dBQ0gsQ0FBQyxDQUFDOztBQUVILEdBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFVBQVUsR0FBRyxFQUFFO0FBQy9CLFVBQU0sQ0FBQyxHQUFHLENBQUMsR0FBRztBQUNaLFdBQUssRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDO0tBQ25CLENBQUM7R0FDSCxDQUFDLENBQUM7O0FBRUgsR0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsVUFBVSxHQUFHLEVBQUU7QUFDakMsVUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHO0FBQ1osYUFBTyxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUM7QUFDcEIsV0FBSyxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUM7S0FDbkIsQ0FBQztHQUNILENBQUMsQ0FBQzs7QUFFSCxTQUFPLE1BQU0sQ0FBQztDQUVmLENBQUMiLCJmaWxlIjoic3JjL2xpYi9kaWZmSlNPTi5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxuXG4ndXNlIHN0cmljdCc7XG5cbnZhciBfID0gcmVxdWlyZSgnbG9kYXNoJyk7XG5cblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBkaWZmSlNPTihvbGRPYmosIG5ld09iaikge1xuXG4gIGlmICghKG9sZE9iaiAmJiBuZXdPYmopKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCd0d28gb2JqZWN0IGlzIHJlcXVpcmVkOicsIG9sZE9iaiwgbmV3T2JqKTtcbiAgfVxuXG4gIHZhciBvbGRLZXlzID0gXy5rZXlzKG9sZE9iaik7XG4gIHZhciBuZXdLZXlzID0gXy5rZXlzKG5ld09iaik7XG5cbiAgdmFyIHJlbW92ZWRLZXlzID0gXy5kaWZmZXJlbmNlKG9sZEtleXMsIG5ld0tleXMpO1xuICB2YXIgYWRkZWRLZXlzID0gXy5kaWZmZXJlbmNlKG5ld0tleXMsIG9sZEtleXMpO1xuICB2YXIgY2hhbmdlZEtleXMgPSBfLmNoYWluKF8uaW50ZXJzZWN0aW9uKG9sZEtleXMsIG5ld0tleXMpKVxuICAgIC5maWx0ZXIoZnVuY3Rpb24gKGtleSkge1xuICAgICAgcmV0dXJuICFfLmlzRXF1YWwob2xkT2JqW2tleV0sIG5ld09ialtrZXldKTtcbiAgICB9KVxuICAgIC52YWx1ZSgpO1xuXG4gIHZhciByZXN1bHQgPSB7fTtcblxuICBfLmVhY2gocmVtb3ZlZEtleXMsIGZ1bmN0aW9uIChrZXkpIHtcbiAgICByZXN1bHRba2V5XSA9IHtcbiAgICAgIHJlbW92ZWQ6IG9sZE9ialtrZXldXG4gICAgfTtcbiAgfSk7XG5cbiAgXy5lYWNoKGFkZGVkS2V5cywgZnVuY3Rpb24gKGtleSkge1xuICAgIHJlc3VsdFtrZXldID0ge1xuICAgICAgYWRkZWQ6IG5ld09ialtrZXldXG4gICAgfTtcbiAgfSk7XG5cbiAgXy5lYWNoKGNoYW5nZWRLZXlzLCBmdW5jdGlvbiAoa2V5KSB7XG4gICAgcmVzdWx0W2tleV0gPSB7XG4gICAgICByZW1vdmVkOiBvbGRPYmpba2V5XSxcbiAgICAgIGFkZGVkOiBuZXdPYmpba2V5XVxuICAgIH07XG4gIH0pO1xuXG4gIHJldHVybiByZXN1bHQ7XG5cbn07XG4iXX0=