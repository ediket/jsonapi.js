<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/modules/Resource.es6 | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
</head>
<body class="layout-container">

<header>
  <a href="./">Home</a>
  <a href="identifiers.html">Identifier</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/ironhee/jsonapi.js.git" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div data-ice="classWrap">
  <h2>Class</h2>
  <ul>
    
  <li data-ice="classDoc"><span><a href="class/src/modules/Link.es6~Link.html">Link</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/modules/Pool.es6~Pool.html">Pool</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/modules/RESTful.es6~RESTful.html">RESTful</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/modules/Relationship.es6~Relationship.html">Relationship</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/modules/Resource.es6~Resource.html">Resource</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/modules/ResourceIdentifier.es6~ResourceIdentifier.html">ResourceIdentifier</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/modules/Response.es6~Response.html">Response</a></span></li>
</ul>
</div>



<div data-ice="functionWrap">
  <h2><a href="function/">Function</a></h2>
  <ul>
    
  <li data-ice="functionDoc"><span><a href="function/index.html#static-function-DB">DB</a></span></li>
</ul>
</div>



<div data-ice="typedefWrap">
  <h2><a href="typedef/">Typedef</a></h2>
  <ul>
    
  <li data-ice="typedefDoc"><span><a href="typedef/index.html#static-typedef-ErrorObject">ErrorObject</a></span></li>
<li data-ice="typedefDoc"><span><a href="typedef/index.html#static-typedef-ErrorSourceObject">ErrorSourceObject</a></span></li>
<li data-ice="typedefDoc"><span><a href="typedef/index.html#static-typedef-LinkObject">LinkObject</a></span></li>
<li data-ice="typedefDoc"><span><a href="typedef/index.html#static-typedef-LinksObject">LinksObject</a></span></li>
<li data-ice="typedefDoc"><span><a href="typedef/index.html#static-typedef-MetaObject">MetaObject</a></span></li>
<li data-ice="typedefDoc"><span><a href="typedef/index.html#static-typedef-RelationshipObject">RelationshipObject</a></span></li>
<li data-ice="typedefDoc"><span><a href="typedef/index.html#static-typedef-ResourceIdentifierObject">ResourceIdentifierObject</a></span></li>
<li data-ice="typedefDoc"><span><a href="typedef/index.html#static-typedef-ResourceLinkage">ResourceLinkage</a></span></li>
<li data-ice="typedefDoc"><span><a href="typedef/index.html#static-typedef-ResourceObject">ResourceObject</a></span></li>
</ul>
</div>

<div data-ice="externalWrap">
  <h2>External</h2>
  <ul>
    
  <li data-ice="externalDoc"><span><a href="http://jsonapi.org/format/#document-resource-object-fields">Fields</a></span></li>
<li data-ice="externalDoc"><span><a href="https://github.com/typicode/lowdb">LowDB</a></span></li>
<li data-ice="externalDoc"><span><a href="https://api.jquery.com/jQuery.ajax/#jqXHR">jqXHR</a></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/modules/Resource.es6</h1>
<pre class="source-code line-number"><code class="prettyprint linenums" data-ice="content">import _ from &apos;lodash&apos;;
import Link from &apos;./Link&apos;;
import Relationship from &apos;./Relationship&apos;;
import ResourceIdentifier from &apos;./ResourceIdentifier&apos;;

/**
 * @external {Fields} http://jsonapi.org/format/#document-resource-object-fields
 */

/**
 * @see http://jsonapi.org/format/#document-resource-objects
 * @typedef {object} ResourceObject
 * @property {!string} type
 * @property {?(string|integer)} id
 * @property {?object} attributes
 * @property {?Object&lt;string, RelationshipObject&gt;} relationships
 * @property {?LinksObject} links
 * @property {?MetaObject} meta
 */

/**
 * @see http://jsonapi.org/format/#document-resource-objects
 * @example
 * let foo = new Resource({
 *   type: &apos;foo&apos;,
 *   id: 2,
 *   attributes: {
 *     content: &apos;foo&apos;
 *   }
 *   relationships: {
 *     bars: {
 *       data: [
 *         { type: &apos;bar&apos;, id: 1 }
 *       ]
 *     }
 *   }
 * });
 *
 * let bar = new Resource({
 *   type: &apos;bar&apos;,
 *   id: 2,
 *   attributes: {
 *     content: &apos;hello&apos;
 *   }
 * });
 *
 * foo.setRelationship(&apos;bar&apos;, bar);
 * foo.setRelationship(&apos;bar&apos;, bar.getIdentifier());
 * foo.setRelationship(&apos;bars&apos;, [bar]);
 * foo.unsetRelationship(&apos;bar&apos;);
 * foo.unsetRelationship(&apos;bars&apos;);
 *
 * foo.setAttribute(&apos;key&apos;, &apos;value&apos;);
 * foo.unsetAttribute(&apos;key&apos;);
 */
export default class Resource extends ResourceIdentifier {

  /**
   * @param {ResourceObject} data
   */
  constructor(data) {
    super(data);
    /** @type {?Object} */
    this.attributes = null;
    /** @type {?Object&lt;string, RelationshipObject&gt;} */
    this.relationships = null;
    /** @type {?LinksObject} */
    this.links = null;
    this.deserialize(data);
  }

  /**
   * @return {ResourceIdentifier}
   */
  getIdentifier() {
    return super.serialize();
  }

  /**
   * @param {string} key
   * @param {ResourceLinkage} resource
   */
  setRelationship(key, resource) {
    if (_.isArray(resource)) {
      this.relationships[key] = new Relationship({
        data: _.map(resource, resource =&gt; ({
          type: resource.type,
          id: resource.id
        }))
      });
    }
    else {
      this.relationships[key] = new Relationship({
        links: resource.links,
        data: {
          type: resource.type,
          id: resource.id
        }
      });
    }
  }

  /**
   * @param {string} key
   */
  unsetRelationship(key) {
    delete this.relationships[key];
  }

  /**
   * @param {Object&lt;string, ResourceLinkage&gt;} relationships
   */
  setRelationships(relationships) {
    _.each(relationships, (relationship, key) =&gt; {
      this.setRelationship(key, relationship);
    });
  }

  /**
   * @param {string} key
   * @param {anything} value
   */
  setAttribute(key, value) {
    this.attributes[key] = value;
  }

  /**
   * @param {string} key
   */
  unsetAttribute(key) {
    delete this.attributes[key];
  }

  /**
   * @param {Object&lt;string, anything&gt;&gt;} key
   */
  setAttributes(attributes) {
    _.extend(this.attributes, attributes);
  }

  /**
   * @return {Fields}
   * @example
   * let foo = new Resource({
   *   type: &apos;foo&apos;,
   *   id: 2,
   *   attributes: {
   *     content: &apos;foo&apos;
   *   }
   *   relationships: {
   *     bars: {
   *       data: [
   *         { type: &apos;bar&apos;, id: 1 }
   *       ]
   *     }
   *   }
   * });
   * // True
   * _.isEqual(foo.flatten() === {
   *   type: &apos;foo&apos;,
   *   id: 2,
   *   content: &apos;foo&apos;,
   *   bars: {
   *     data: [
   *       { type: &apos;bar&apos;, id: 1 }
   *     ]
   *   }
   * });
   */
  flatten() {
    return _.chain({})
    .extend(this.getIdentifier())
    .extend(this.attributes)
    .extend(_.mapValues(this.relationships, relationship =&gt; relationship.serialize()))
    .value();
  }

  /**
   * @return {ResourceObject}
   */
  serialize() {
    return _.chain({
      attributes: this.attributes,
      links: _.mapValues(this.links, link =&gt; link.serialize()),
      relationships: _.mapValues(this.relationships, relationship =&gt; relationship.serialize())
    })
    .extend(this.getIdentifier())
    .omit(attribute =&gt; _.isObject(attribute) ?
      _.isEmpty(attribute) : _.isUndefined(attribute))
    .value();
  }

  /**
   * @param {ResourceObject} data
   */
  deserialize(data) {
    super.deserialize(data);
    this.attributes = data.attributes;
    this.relationships = _.mapValues(data.relationships,
      relationship =&gt; new Relationship(relationship));
    this.links = _.mapValues(data.links,
      link =&gt; new Link(link));
  }

}
</code></pre>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.1.2)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
